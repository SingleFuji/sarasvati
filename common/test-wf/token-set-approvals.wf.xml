<?xml version="1.0"?>

<process-definition name="token-set-approvals"
                   xmlns="http://sarasvati.googlecode.com/ProcessDefinition">

  <node name="setup-approvals" type="approvalSetup" isStart="true">
    <arc to="approval"/>
  </node>

  <node name="approval" type="approval" >
    <arc to="show-approval"/>
  </node>

  <node name="show-approval" type="script" >
    <arc to="finish-approval"/>

    <custom>
      <execute type="js">
        <![CDATA[
          var group = token.getTokenSetMember( "approvals" ).getEnv().getAttribute( "group" );
          java.lang.System.out.println( "Group: " + group );
          engine.complete( token, null );
        ]]>
      </execute>
    </custom>

  </node>

  <node name="finish-approval" type="node" joinType="tokenSetAnd">
    <guard>IF Approved THEN Skip approved ELSE Skip denied</guard>
    <arc name="approved" to="approved"/>
    <arc name="denied" to="denied"/>
  </node>

  <node name="approved" type="message">
    <custom>
      <message>Your request has been approved</message>
    </custom>
  </node>

  <node name="denied" type="message">
    <custom>
      <message>Your request has been approved</message>
    </custom>
  </node>

</process-definition>